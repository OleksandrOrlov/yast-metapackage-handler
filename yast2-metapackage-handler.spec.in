@HEADER-COMMENT@

@HEADER@
License: GPL v2 or later

# should be required by devtools
BuildRequires: pkgconfig perl-XML-Writer
# y2tool
BuildRequires: yast2-devtools
# ycpc
BuildRequires: yast2-core
# we have a Perl part
BuildRequires: yast2-perl-bindings
BuildRequires:	perl-XML-XPath
BuildRequires:	yast2
BuildRequires:	yast2-country-data
BuildRequires:	yast2-transfer
BuildRequires:	yast2-packager
# desktop files
BuildRequires:	update-desktop-files

Patch0:	SLE.diff
Patch1: 103.diff

Requires: 	yast2-perl-bindings
Requires:	perl-XML-XPath
Requires:	yast2
Requires:	yast2-packager
Requires:	yast2-transfer
# Language
Requires:	yast2-country-data
# needed at runtime for invoking root mode
Requires:	/usr/bin/xdg-su

BuildArchitectures:	noarch

Summary:			YaST2 - Easy Installation of Add-on RPMs using Metapackages

%description
With this technology users can install packages and add repositories
with a simple click on a link in a website.

@PREP@

%if %suse_version <= 1020
%patch0
%endif

%if %suse_version <= 1030
%patch1
%endif

@BUILD@

@INSTALL@
%if %suse_version <= 1020
mkdir -p $RPM_BUILD_ROOT/opt/kde3/share/applnk/.hidden/
mkdir -p $RPM_BUILD_ROOT/opt/kde3/share/mimelnk/text/
chmod -R 0755 $RPM_BUILD_ROOT/opt/kde3
install -m 0644 src/kdeymp.desktop \
	$RPM_BUILD_ROOT/opt/kde3/share/applnk/.hidden/
install -m 0644 src/x-suse-ymp.desktop \
	$RPM_BUILD_ROOT/opt/kde3/share/mimelnk/text/
%endif
%suse_update_desktop_file yast2-metapackage-handler 
%suse_update_desktop_file yast2-metapackage-handler-ymu

@CLEAN@

%post
# #330352, SuSEconfig.desktop-file-utils only calls
# update-desktop-database
if test -x usr/bin/update-mime-database ; then
  usr/bin/update-mime-database usr/share/mime >/dev/null
fi

%postun
if test -x usr/bin/update-mime-database ; then
  usr/bin/update-mime-database usr/share/mime >/dev/null
fi

%files
%defattr(-,root,root)
%doc @docdir@
/sbin/OneClickInstallUI
/sbin/OneClickInstallUrlHandler
/sbin/OneClickInstallCLI
/sbin/OCICLI
%dir @clientdir@
@clientdir@/*.ycp
%dir @moduledir@
@moduledir@/*.ycp
@moduledir@/*.ybc
@moduledir@/*.pm
%if %suse_version <= 1020
/opt/kde3
%endif
%{_datadir}/mime/packages/*.xml
%{_datadir}/applications/yast2-metapackage-handler*.desktop
